#note #raid #utils
Все действия выполняются на ОС Proxmox 8.4 (Debian). Рейд контроллер P440ar на сервере HP Dl 360 G9
Для установки утилиты требуется ее скачать или закинуть из файлопомойки на сервер
Скачиваем утилиту 
```
wget https://downloads.linux.hpe.com/sdr/repo/mcp/pool/non-free/hpssacli-2.40-13.0_amd64.deb
```

Устанавливаем пакет
```
dpkg -i hpssacli-2.40-13.0_amd64.deb
```
Далее мы можем использовать команды:

Посмотреть статус контроллера
```
hpssacli ctrl all show status
```
Статус покажет текущее состояние контроллера и его слот
Далее мы будем использовать параметр слота в качестве указателя для дальнейших команд
Посмотреть физические диски
```
hpssacli ctrl slot=0 pd all show status
```
Посмотрев диски можно узнать их расположение в сервере вида 
```
physicaldrive 1I:1:1 (port 1I:box 1:bay 1, 300 GB): OK
```
Указывается что это физический диск находящийся в порте 1i в боксе 1 слоте 1
Эти данные понадобиться нам для дальнейшей настройки

Посмотреть логические диски
```
hpssacli ctrl slot=0 ld all show status
```

Полная информация по контроллеру
```
hpssacli ctrl all show detail
```
Собрать рейд 
```
hpssacli ctrl slot=0 create type=ld drives=1I:1:3 raid=0 stripsize=16
```
Указываем контроллер в нужном слоте. Указываем тип логический диск кеазываем через запятую диски в формате порт:бокс:слот. Указываем уровень рейда и размер страйпа.
Страйп это блок данных который записывается за одну итерацию IO. Для больших файлов лучше большой блок, для маленьких маленький.
Размеры страйпов бывают:
8
16
32
64
128
256
512
1024
Лучше всего смотреть в спеках рейд котроллера.
Для удаления рейда
```
hpssacli ctrl slot=0 logicaldrive 2 delete
```
Так же указываем контроллер, какой логический диск и команду удалить. Если диск используется из ОС, то он не даст его удалить. 

Включения кеша контроллера при работе с SSD.
Отключаем функцию SSDSmartPath.
Это функция позволяет увеличить производительность дисков при большом их количестве, так как кеш маленький по размеру. При малом количестве дисков следует включить кеш контроллера для увеличения производительности.
Эти функции надо включить и перевести систему в ХБА режим если мы планируем строить SDS
```
hpssacli ctrl slot=2 array A modify ssdsmartpath=disable
```
Выбираем слот контроллера и какой массив будем использовать

```
hpssacli ctrl slot=2 logicaldrive 1 modify arrayaccelerator=enable
```
